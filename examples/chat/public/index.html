<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//code.responsivevoice.org/responsivevoice.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.5/socket.io.js"></script>
<script>
    var socket = io();
    var notificationQueue = [];
    var speaking = false;

    socket.on('new_notification', function (data) {
      console.log(data);
      notificationQueue.push(data);        
    });
    
    var intervalID = setInterval(function(){
    	if(!speaking && notificationQueue.length > 0) {		
    	  speakOut(notificationQueue[0])	
    	}    	
    }, 1000);

    speakEnd = function(){
      speaking = false;
      notificationQueue.shift()
    }

    var speakOut = function(data) {
      speaking = true
      console.log('speakout: ');
      console.log(data);
      if(data.mp3_slug !== '') {
        $('#'+data.mp3_slug)[0].play()	
        $('#'+data.mp3_slug).bind("ended", function(){
          responsiveVoice.speak(data.message, "UK English Female", {onend: speakEnd});    
        });
      } else {
        responsiveVoice.speak(data.message, "UK English Female", {onend: speakEnd});
      }
    }

</script>
<body>
	<audio id="pay-attention" style="display:none" controls>
      <source src="PayAttention.wav" type="audio/wav">
      Your browser does not support the audio element.
    </audio>
</body>
